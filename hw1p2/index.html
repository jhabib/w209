<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>W209: Homework 1, Part 2</title>
	<link rel="stylesheet" href="dc.css">
</head>
<body>
	<h1>W209: Homework 1, Part 2</h1>
	<h2>Mohammad's Sleep and Coffee Intake</h2>

	<div id="sleepHistDiv">
    	<strong>Hours of Sleep Histrogram</strong>
		<span class="reset" style="display: none;">Selected: <span class="filter"></span></span>
		<a class="reset" href="javascript:coffeeSleepTimeSeries.filterAll();dc.redrawAll();" style="display: none;">reset</a>
		<div class="clearfix"></div>
	</div>

	<div id="coffeeHistDiv">
		<strong>Cups of Coffee Histrogram</strong>
		<span class="reset" style="display: none;">Selected:
			<span class="filter"></span>
		</span>
		<a class="reset" href="javascript:coffeeSleepTimeSeries.filterAll();dc.redrawAll();" style="display: none;">reset</a>
		<div class="clearfix"></div>
	</div>

	<div id="coffeeSleepScatterDiv">
		<strong>Hours of Sleep by Cups of Coffee</strong>
		<span class="reset" style="display: none;">Selected:
			<span class="filter"></span>
		</span>
		<a class="reset" href="javascript:coffeeSleepTimeSeries.filterAll();dc.redrawAll();" style="display: none;">reset</a>
		<div class="clearfix"></div>
	</div>

	<div id="coffeeSleepTimeSeriesDiv">
		<strong>Coffee and Sleep by Date</strong>
		<span class="reset" style="display: none;">Selected:
			<span class="filter"></span>
		</span>
		<a class="reset" href="javascript:coffeeSleepTimeSeries.filterAll();dc.redrawAll();" style="display: none;">reset</a>
		<div class="clearfix"></div>
	</div>

	
	<div>
    	<div class="dc-data-count">
    	<span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a
              href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
    	</div>
    </div>
	
	<table class="table table-hover dc-data-table">
	</table>
	
	<div>
		<p>
			These charts show the number of hours I "sleep" at night, and the number of cups of coffee I drink the next morning. Hours
			of "sleep", and cups of coffee are plotted on the y-axis, and the date is plotted on the x-axis. In the timeseries chart, the blue line represents
			the hours of "sleep" and the red line represents the cups of coffee. You can see that the less "sleep" I have at night,
			the more coffee I drink in the morning. The more coffee I drink in the morning, the less I "sleep" the next night. It's a
			vicious circle.
		</p>
	</div>

	<script src="crossfilter.js"></script>
	<script src="d3.js"></script>
	<script src="dc.js"></script>

	<script>

		var sleepHist = dc.barChart("#sleepHistDiv"),
			coffeeHist = dc.barChart("#coffeeHistDiv"), 
			coffeeSleepScatter = dc.scatterPlot("#coffeeSleepScatterDiv"), 
			coffeeSleepTimeSeries = dc.compositeChart("#coffeeSleepTimeSeriesDiv"), 
			visCount = dc.dataCount(".dc-data-count"),
			visTable = dc.dataTable(".dc-data-table");

		var url = "sleep.tsv";

		var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

		d3.tsv(url, function (err, data) {
			// date	coffee	sleep
			// 2018,02,17	5	8
			
			if (err) throw err;
			
			// convert date string to a date object
			data.forEach(function (d) {
				d.sleep = +d.sleep;
				d.coffee = +d.coffee;
				d.date = new Date(d.date);
				d.day = days[d.date.getDay()];
			});

			var ndx = crossfilter(data); 
			var all = ndx.groupAll();			

			var sleepDimension = ndx.dimension(function(d) {return +d.sleep;});
			var sleepGroup = sleepDimension.group();

			var coffeeDimension = ndx.dimension(function(d) {return +d.coffee;});
			var coffeeGroup = coffeeDimension.group();

			var scatterDimension = ndx.dimension(function(d) {return [+d.coffee, +d.sleep];});
			var scatterGroup = scatterDimension.group();

			var daysDim = ndx.dimension(function (d) { return d.date; });
			var daysCoffeeGroup = daysDim.group().reduceSum(function(d) {return +d.coffee;});
			var daysSleepGroup = daysDim.group().reduceSum(function (d) { return +d.sleep; });

			sleepHist
				.dimension(sleepDimension)
				.group(sleepGroup)
				.x(d3.scale.linear().domain([0, 15]))				
				.elasticY(true)
				.xAxis().tickFormat();
			
			coffeeHist
				.dimension(coffeeDimension)
				.group(coffeeGroup)
				.x(d3.scale.linear().domain([0, 7]))
				.elasticY(true)
				.ordinalColors(["red"])
				.xAxis().tickFormat();
			
			coffeeSleepScatter
				.x(d3.scale.linear().domain([0, 10]))
				.y(d3.scale.linear().domain([0, 18]))
				.yAxisLabel("Hours of Sleep")
				.xAxisLabel("Cups of Coffee")
				.dimension(scatterDimension)
				.group(scatterGroup);

			coffeeSleepTimeSeries
				.width(960)
				.transitionDuration(500)
				.mouseZoomable(false)
				.dimension(daysDim)
				.x(d3.time.scale().domain([new Date(2018, 01, 01), new Date(2018, 02, 28)]))
				.elasticY(true)
				.elasticX(true)
				.shareTitle(false)
				.renderHorizontalGridLines(true)
				.legend(dc.legend().x(70).y(10).itemHeight(13).gap(5))
				.brushOn(false)
				.compose([
					dc.lineChart(coffeeSleepTimeSeries)
						.group(daysSleepGroup, "Sleep Hours")
						.valueAccessor(function (d) { return d.value; }).title(function (d) {
							return d.key + "\nSleep: " + d.value;
						})
						.dashStyle([2, 2]), 
					dc.lineChart(coffeeSleepTimeSeries)						
						.group(daysCoffeeGroup, "Coffee Cups")
						.valueAccessor(function (d) { return d.value; }).title(function(d) {
							return d.key + "\nCoffee: " + d.value;
						})
						.ordinalColors(["red"])

				])
				.yAxisLabel("Count")
				.renderHorizontalGridLines(true);
				
			visCount
				.dimension(ndx)
				.group(all);
			visTable
				.dimension(daysDim)
				.group(function (d) {
            var format = d3.format('02d');
            return d.day;
        }).columns([
					"date",
					"coffee",
					"sleep", 
					"day"
					]);
			dc.renderAll();
		});


	</script>
</body>
</html>